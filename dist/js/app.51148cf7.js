(function(){"use strict";var t={2928:function(t,e,n){n(6133);var o=n(9242),r=n(3396);const i={class:"spreadBoard"},s={class:"editor"},a=(0,r._)("div",{class:"output-view-container"},[(0,r._)("div",{class:"output-view"}," Test ")],-1);function u(t,e){const n=(0,r.up)("ReteEditor"),o=(0,r.up)("ReteDock");return(0,r.wg)(),(0,r.iD)("div",i,[(0,r._)("div",s,[(0,r.Wm)(n),(0,r.Wm)(o)]),a])}var d=n(6520);const c={class:"rete",ref:"reteElm"};function l(t,e){return(0,r.wg)(),(0,r.iD)("div",c,null,512)}var p=n(4870),h=n(4306),v=n(4541),m=n(5443),w=n(869),g=n(7212),f=n(1329),k=n(2482);class y{constructor(t){(0,k.Z)(this,"name",void 0),(0,k.Z)(this,"refSocket",void 0),(0,k.Z)(this,"valSocket",void 0),this.name=t,this.refSocket=new h.sk(t+" ref"),this.valSocket=new h.sk(t+" val")}}const Z=new h.sk("type"),x=new y("any");class b{constructor(){(0,k.Z)(this,"types",void 0),this.types=new Map}add(t){if(!(t in this.types.keys())){const e=new y(t);this.types.set(t,e),e.refSocket.combineWith(x.refSocket),e.valSocket.combineWith(x.valSocket)}}getRefByVal(t){return this.get(t.name.replace(" val","")).refSocket}getValByRef(t){return this.get(t.name.replace(" ref","")).valSocket}get(t){return this.types.get(t)}}const P=new b;P.add("text"),P.add("number"),P.add("boolean");const M=new h.ZP.Socket("act");P.get("number").valSocket.combineWith(P.get("text").valSocket);const C={val:"Wert",ref:"Variable",num:"Zahl",addIn:"Summand",act:"Aktion",txt:"Text",add:"Addiere",res:"Ergebnis",curVal:"Aktueller Wert",initVal:"Startwert",setVar:"Setze Variable",trigger:"Auslöser",header:"Überschrift",combine:"Zusammenfügen",numVar:"Variable:\nZahl",type:"Datentyp",view:"Anzeige"},S={de:C};var O=S;class V extends h.ZP.Component{constructor(t){super(O.de.view),(0,k.Z)(this,"containerQuery",void 0),this.containerQuery=t}async builder(t){return t.addInput(new h.ZP.Input("in","",P.get("text").valSocket)),t}worker(t,e,n){if(this.containerQuery){const t=document.querySelector(this.containerQuery);t&&(t.innerHTML=e["in"][0]?e["in"][0]:"")}}}const I=["readonly","value"];function D(t,e,n,i,s,a){return(0,r.wg)(),(0,r.iD)("input",{type:"number",readonly:n.readonly,value:s.value,onInput:e[0]||(e[0]=t=>a.change(t)),onDblclick:e[1]||(e[1]=(0,o.iM)((()=>{}),["stop"])),onPointerdown:e[2]||(e[2]=(0,o.iM)((()=>{}),["stop"])),onPointermove:e[3]||(e[3]=(0,o.iM)((()=>{}),["stop"]))},null,40,I)}var E={props:["readonly","emitter","ikey","getData","putData"],name:"VueNumComponent",data(){return{value:0}},methods:{change(t){this.value=+t.target.value,this.update()},update(){this.ikey&&this.putData(this.ikey,this.value),this.emitter.trigger("process")}},mounted(){this.value=this.getData(this.ikey)}};(0,r.bv)((()=>{(void 0).value=(void 0).getData((void 0).ikey)}));var R=n(89);const _=(0,R.Z)(E,[["render",D]]);var B=_;class W extends h.ZP.Control{constructor(t,e,n=!1){super(e),(0,k.Z)(this,"component",void 0),(0,k.Z)(this,"props",void 0),this.component=B,this.props={emitter:t,ikey:e,readonly:n}}setValue(t){this.vueContext.value=t}}class j extends h.ZP.Component{constructor(){super(O.de.add)}async builder(t){const e=new h.ZP.Input("num",O.de.addIn,P.get("number").valSocket),n=new h.ZP.Input("num2",O.de.addIn,P.get("number").valSocket),o=new h.ZP.Output("num",O.de.res,P.get("number").valSocket);e.addControl(new W(this.editor,"num",!1)),n.addControl(new W(this.editor,"num2",!1)),t.addInput(e).addInput(n).addControl(new W(this.editor,"preview",!0)).addOutput(o)}worker(t,e,n,...o){const r=e["num"].length?e["num"][0]:t.data.num,i=e["num2"].length?e["num2"][0]:t.data.num2,s=r+i,a=this.editor.nodes.find((e=>e.id==t.id)).controls.get("preview");a.setValue(s),n["num"]=s}}class T extends h.ZP.Component{constructor(){super(O.de.num)}async builder(t){const e=new h.ZP.Output("num",O.de.num,P.get("number").valSocket);return t.addControl(new W(this.editor,"num",!1)).addOutput(e)}worker(t,e,n){n["num"]=t.data.num}}const A=["readonly","value"];function N(t,e,n,i,s,a){return(0,r.wg)(),(0,r.iD)("input",{type:"text",readonly:n.readonly,value:s.value,onInput:e[0]||(e[0]=t=>a.change(t)),onDblclick:e[1]||(e[1]=(0,o.iM)((()=>{}),["stop"])),onPointerdown:e[2]||(e[2]=(0,o.iM)((()=>{}),["stop"])),onPointermove:e[3]||(e[3]=(0,o.iM)((()=>{}),["stop"]))},null,40,A)}var Q={props:["readonly","emitter","ikey","getData","putData"],name:"VueTextComponent",data(){return{value:""}},methods:{change(t){this.value=t.target.value,this.update()},update(){this.ikey&&this.putData(this.ikey,this.value),this.emitter.trigger("process")}},mounted(){this.value=this.getData(this.ikey)}};(0,r.bv)((()=>{(void 0).value=(void 0).getData((void 0).ikey),(void 0).value||((void 0).value="")}));const z=(0,R.Z)(Q,[["render",N]]);var J=z;class q extends h.ZP.Control{constructor(t,e,n=!1){super(e),(0,k.Z)(this,"component",void 0),(0,k.Z)(this,"props",void 0),this.component=J,this.props={emitter:t,ikey:e,readonly:n}}setValue(t){this.vueContext.value=t}}class H extends h.ZP.Component{constructor(){super(O.de.txt)}async builder(t){const e=new h.ZP.Output("txt",O.de.txt,P.get("text").valSocket);return t.addControl(new q(this.editor,"txt",!1)).addOutput(e)}worker(t,e,n){n["txt"]=t.data.txt}}class L extends h.ZP.Component{constructor(){super(O.de.combine)}async builder(t){const e=new h.ZP.Input("txt",O.de.txt,P.get("text").valSocket),n=new h.ZP.Input("txt2",O.de.txt,P.get("text").valSocket),o=new h.ZP.Output("txt",O.de.res,P.get("text").valSocket);e.addControl(new q(this.editor,"txt",!1)),n.addControl(new q(this.editor,"txt2",!1)),t.addInput(e).addInput(n).addControl(new q(this.editor,"preview",!0)).addOutput(o)}worker(t,e,n,...o){let r=e["txt"].length?e["txt"][0]:t.data.txt;void 0==r&&(r="");let i=e["txt2"].length?e["txt2"][0]:t.data.txt2;void 0==i&&(i="");const s=r+""+i;return this.editor.nodes.find((e=>e.id==t.id)).controls.get("preview").setValue(s),n["txt"]=s,null}}class F extends h.ZP.Component{constructor(){super(O.de.header)}async builder(t){const e=new h.ZP.Input("txt",O.de.txt,P.get("text").valSocket),n=new h.ZP.Output("h",O.de.header,P.get("text").valSocket);return e.addControl(new q(this.editor,"txt",!1)),t.addInput(e).addControl(new q(this.editor,"preview",!0)).addOutput(n)}worker(t,e,n){const o=e["txt"].length?e["txt"][0]:t.data.txt,r="<h1>"+o+"</h1>";this.editor.nodes.find((e=>e.id==t.id)).controls.get("preview").setValue(r),n["h"]=r}}class G{constructor(t){(0,k.Z)(this,"onChange",void 0),(0,k.Z)(this,"get",(()=>this.curValue)),this.onChange=t}set(t){this.curValue=t,this.edited=!0,this.onChange(t)}setInitial(t){this.initVal=t,this.edited||(this.curValue=t)}reset(){this.curValue=this.initVal,this.edited=!1}}class K extends h.ZP.Component{constructor(){super(O.de.numVar),(0,k.Z)(this,"variables",void 0),this.variables=new Map}async builder(t){const e=new h.ZP.Input("val",O.de.initVal,P.get("number").valSocket);e.addControl(new W(this.editor,"val")),this.variables.set(t.id,new G((e=>{t.update(),this.setPreview(t,e),this.editor.trigger("process")})));const n=new h.ZP.Output("ref",O.de.ref,P.get("number").refSocket),o=new h.ZP.Output("val",O.de.curVal,P.get("number").valSocket),r=new h.ZP.Output("type",O.de.type,Z);return t.addControl(new W(this.editor,"preview",!0)).addInput(e).addOutput(r).addOutput(n).addOutput(o)}setPreview(t,e){const n=t.controls.get("preview");n.setValue(e)}worker(t,e,n){const o=e["val"].length?e["val"][0]:t.data.val,r=this.variables.get(t.id);r.setInitial(o),this.setPreview(this.editor.nodes.find((e=>e.id==t.id)),r.get()),n["val"]=r.get(),n["ref"]=r,n["type"]="number"}}function U(t,e,n,o,i,s){return(0,r.wg)(),(0,r.iD)("button",{onClick:e[0]||(e[0]=t=>s.change(""))})}var X={props:["emitter","ikey"],name:"VueButtonComponent",methods:{change(t){this.emitter(t)}}};const Y=(0,R.Z)(X,[["render",U],["__scopeId","data-v-0e180730"]]);var $=Y;class tt extends h.ZP.Control{constructor(t,e){super(e),(0,k.Z)(this,"component",void 0),(0,k.Z)(this,"props",void 0),this.component=$,this.props={emitter:t,ikey:e}}}n(7658);class et{constructor(){(0,k.Z)(this,"onEmits",new Map)}emit(t){for(const e of this.onEmits.values())e.call(t)}}class nt extends h.ZP.Component{constructor(t){super(t),(0,k.Z)(this,"emitterMap",void 0),(0,k.Z)(this,"listenerMap",void 0),(0,k.Z)(this,"inputMap",void 0),(0,k.Z)(this,"outputMap",void 0),(0,k.Z)(this,"nodeMap",void 0),this.listenerMap=new Map,this.emitterMap=new Map,this.inputMap=new Map,this.nodeMap=new Map,this.outputMap=new Map}worker(t,e,n){const o=this.editor.nodes.find((e=>e.id==t.id));this.listenerMap.get(t.id)&&this.listenerMap.get(t.id).forEach((e=>e.onEmits.delete(t.id))),this.listenerMap.set(t.id,[]);for(const r of o.inputs.keys())if(r.includes("act")){const n=e[r][0];n&&(console.log("Listening"),this.listenerMap.get(t.id).push(n),n.onEmits.set(t.id,(e=>this.run(t.id,e))))}for(const r of o.outputs.keys())r.includes("act")&&(this.emitterMap.get(t.id)||this.emitterMap.set(t.id,new et),n[r]=this.emitterMap.get(t.id));return this.inputMap.set(t.id,e),this.outputMap.set(t.id,n),this.nodeMap.set(t.id,t),{node:t,inputs:e,outputs:n}}run(t,e){const n=this.nodeMap.get(t);this.editor.nodes.find((e=>e.id==t));this.task(n,this.inputMap.get(t),this.outputMap.get(t),e).then((e=>{this.emitterMap.get(t).emit(e)}))}}class ot extends nt{constructor(){super(O.de.trigger)}async builder(t){t.addControl(new tt((()=>{this.run(t.id,"onClick")}),"start")),t.addOutput(new h.ZP.Output("act","",M))}worker(t,e,n){super.worker(t,e,n)}async task(t,e,n,o){return n}}class rt extends nt{constructor(){super(O.de.setVar),(0,k.Z)(this,"types",void 0),this.types=new Map}async builder(t){const e=new h.ZP.Input("ref",O.de.ref,x.refSocket),n=new h.ZP.Input("val",O.de.val,x.valSocket),o=new h.ZP.Input("act",O.de.act,M),r=new h.ZP.Output("act",O.de.act,M);return t.addControl(new W(this.editor,"preview",!1)).addInput(e).addInput(n).addInput(o).addOutput(r)}worker(t,e,n){super.worker(t,e,n);const o=this.editor.nodes.find((e=>e.id==t.id)),r=o.getConnections().find(((t,e)=>"ref"==t.input.key)),i=o.getConnections().find(((t,e)=>"val"==t.input.key));r&&r.output.socket&&i&&i.output.socket&&i.output.socket!=P.getValByRef(r.output.socket)?i.remove():r&&r.output.socket?o.inputs.get("val").socket=P.getValByRef(r.output.socket):i&&i.output.socket?o.inputs.get("ref").socket=P.getRefByVal(i.output.socket):(r&&r.remove(),i&&i.remove(),o.inputs.get("ref").socket=x.refSocket,o.inputs.get("val").socket=x.valSocket)}async task(t,e,n,o){const r=e["ref"][0],i=e["val"][0];return r&&i&&r.set(i),n}}async function it(t){const e=new h.ZP.NodeEditor("demo@0.1.0",t),n=new h.ZP.Engine("demo@0.1.0");e.use(m.Z),e.use(v.Z),e.use(g.Z,{background:!1,snap:!1,scaleExtent:{min:.25,max:1},translateExtent:{width:5e3,height:4e3}});const o=new V(".output-view");e.register(o),n.register(o),e.use(w.ZP),e.use(f.Z,{container:document.querySelector(".dock"),plugins:[v.Z]});const r=[new j,new T,new H,new L,new F,new K,new ot,new rt];for(let i=0;i<r.length;i++)e.register(r[i]),n.register(r[i]);await e.fromJSON({id:"demo@0.1.0",nodes:{1:{id:1,position:[100,50],name:"OutputComponent",inputs:null,outputs:null,data:null}}}),e.on(["connectioncreate","connectionremove","nodecreate","noderemove"],(t=>{console.log("editor something",t),console.log("editor",e.toJSON()),e.trigger("process")})),e.on("process",(async()=>{await n.abort(),await n.process(e.toJSON())})),e.view.resize()}var st={name:"ReteEditor",setup(){const t=(0,p.iH)(null);return(0,r.bv)((()=>{it(t.value)})),{reteElm:t}}};const at=(0,R.Z)(st,[["render",l]]);var ut=at;const dt={class:"dock"},ct=(0,r._)("h3",null,"Options",-1),lt=[ct];function pt(t,e,n,o,i,s){return(0,r.wg)(),(0,r.iD)("div",dt,lt)}var ht={name:"ReteDock",setup(){}};const vt=(0,R.Z)(ht,[["render",pt]]);var mt,wt,gt=vt;let ft=(mt=(0,d.Ei)({components:{ReteEditor:ut,ReteDock:gt}}),mt(wt=class extends d.w3{})||wt);const kt=(0,R.Z)(ft,[["render",u]]);var yt=kt;(0,o.ri)(yt).mount("#app")}},e={};function n(o){var r=e[o];if(void 0!==r)return r.exports;var i=e[o]={exports:{}};return t[o](i,i.exports,n),i.exports}n.m=t,function(){var t=[];n.O=function(e,o,r,i){if(!o){var s=1/0;for(c=0;c<t.length;c++){o=t[c][0],r=t[c][1],i=t[c][2];for(var a=!0,u=0;u<o.length;u++)(!1&i||s>=i)&&Object.keys(n.O).every((function(t){return n.O[t](o[u])}))?o.splice(u--,1):(a=!1,i<s&&(s=i));if(a){t.splice(c--,1);var d=r();void 0!==d&&(e=d)}}return e}i=i||0;for(var c=t.length;c>0&&t[c-1][2]>i;c--)t[c]=t[c-1];t[c]=[o,r,i]}}(),function(){n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,{a:e}),e}}(),function(){n.d=function(t,e){for(var o in e)n.o(e,o)&&!n.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){var t={143:0};n.O.j=function(e){return 0===t[e]};var e=function(e,o){var r,i,s=o[0],a=o[1],u=o[2],d=0;if(s.some((function(e){return 0!==t[e]}))){for(r in a)n.o(a,r)&&(n.m[r]=a[r]);if(u)var c=u(n)}for(e&&e(o);d<s.length;d++)i=s[d],n.o(t,i)&&t[i]&&t[i][0](),t[i]=0;return n.O(c)},o=self["webpackChunkspreadboard"]=self["webpackChunkspreadboard"]||[];o.forEach(e.bind(null,0)),o.push=e.bind(null,o.push.bind(o))}();var o=n.O(void 0,[998],(function(){return n(2928)}));o=n.O(o)})();
//# sourceMappingURL=app.51148cf7.js.map